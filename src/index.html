<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin" />
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp" />
    <title>CursorCine</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main class="layout">
      <section class="controls">
        <h1>CursorCine</h1>
        <p class="sub">Electron 桌面錄影 + 滑鼠跟隨自動 Zoom</p>

        <div class="buttons buttons-sticky">
          <button id="recordBtn">開始錄影</button>
          <button id="stopBtn" disabled>停止錄製</button>
          <button id="refreshBtn">重新整理來源</button>
        </div>

        <p id="status" class="status">尚未開始錄影</p>
        <p id="recordingTime" class="recording-time">目前錄製時間: 00:00.0</p>
        <p id="exportTime" class="export-time">輸出執行時間: 00:00.0</p>

        <details class="control-group" open>
          <summary>基本設定</summary>
          <div class="group-content">
            <label>
              錄製來源
              <select id="sourceSelect"></select>
            </label>

            <label>
              輸出格式
              <select id="formatSelect">
                <option value="webm" selected>WebM</option>
                <option value="mp4">MP4（若不支援會自動改 WebM）</option>
              </select>
            </label>

            <label>
              剪輯輸出引擎
              <select id="exportEngineSelect">
                <option value="auto" selected>自動（優先 ffmpeg，失敗改內建）</option>
                <option value="ffmpeg">只用 ffmpeg</option>
                <option value="builtin">只用內建</option>
              </select>
            </label>

            <label>
              畫質檔位
              <select id="qualitySelect">
                <option value="smooth">流暢（較省資源）</option>
                <option value="balanced" selected>平衡（推薦）</option>
                <option value="high">高畫質（較吃效能）</option>
              </select>
            </label>

            <label>
              輸出畫質（獨立）
              <select id="outputQualitySelect">
                <option value="smooth">流暢輸出（最快）</option>
                <option value="balanced" selected>平衡輸出（推薦）</option>
                <option value="high">高畫質輸出（最慢）</option>
              </select>
            </label>

            <label>
              HDR Mapping（Windows）
              <select id="hdrMappingModeSelect">
                <option value="auto" selected>Auto（可用則 Native，否則回退）</option>
                <option value="off">Off（只用既有錄影）</option>
                <option value="force-native">Force Native（不可用則阻止開始）</option>
              </select>
            </label>
            <p class="hdr-mapping-meta">
              <span id="hdrMappingRuntime">目前路徑: Fallback（待命）</span>
              <span id="hdrMappingProbe">Probe: 尚未探測</span>
              <span id="hdrMappingDiag">Diag: 尚未開始</span>
              <button id="copyHdrDiagBtn" type="button">複製 HDR 診斷 JSON</button>
              <button id="runHdrSmokeBtn" type="button">執行 Native Smoke</button>
            </p>

            <label>
              <span>聲音設定</span>
              <span>
                <input id="micInput" type="checkbox" />
                包含麥克風（系統聲音會盡量一併錄製）
              </span>
            </label>
          </div>
        </details>

        <details class="control-group" open>
          <summary>鏡頭與游標</summary>
          <div class="group-content">
            <label>
              最大 Zoom 倍率 <span id="zoomLabel">1.8x</span>
              <input id="zoomInput" type="range" min="1.2" max="3" step="0.1" value="1.8" />
            </label>

            <label>
              鏡頭平滑係數 <span id="smoothLabel">0.16</span>
              <input id="smoothInput" type="range" min="0.05" max="0.4" step="0.01" value="0.16" />
            </label>

            <label>
              光點大小 <span id="glowSizeLabel">22</span>
              <input id="glowSizeInput" type="range" min="10" max="60" step="1" value="22" />
            </label>

            <label>
              光點核心 <span id="glowCoreLabel">5</span>
              <input id="glowCoreInput" type="range" min="2" max="20" step="1" value="5" />
            </label>

            <label>
              光點亮度 <span id="glowOpacityLabel">0.90</span>
              <input id="glowOpacityInput" type="range" min="0.20" max="1.00" step="0.05" value="0.90" />
            </label>
          </div>
        </details>

        <details class="control-group">
          <summary>HDR 補償（實驗）</summary>
          <div class="group-content">
            <label>
              <span>HDR 補償（實驗）</span>
              <span>
                <input id="hdrCompEnable" type="checkbox" />
                開啟
              </span>
            </label>

            <label>
              HDR 補償強度 <span id="hdrCompStrengthLabel">-0.70</span>
              <input id="hdrCompStrength" type="range" min="-1" max="1" step="0.05" value="-0.7" />
            </label>

            <label>
              HDR 色相校正 <span id="hdrCompHueLabel">-9°</span>
              <input id="hdrCompHue" type="range" min="-30" max="30" step="1" value="-9" />
            </label>

            <label>
              高亮壓縮 <span id="hdrCompRolloffLabel">0.70</span>
              <input id="hdrCompRolloff" type="range" min="0" max="1" step="0.05" value="0.7" />
            </label>

            <label>
              清晰度（實驗） <span id="hdrCompSharpnessLabel">1.00</span>
              <input id="hdrCompSharpness" type="range" min="0" max="1" step="0.05" value="1.0" />
            </label>
          </div>
        </details>

        <details class="control-group">
          <summary>畫筆工具</summary>
          <div class="group-content">
            <div class="pen-tools">
              <button id="penToggleBtn" type="button" aria-pressed="false">畫筆模式: 關</button>
              <label>
                畫筆顏色
                <input id="penColorInput" type="color" value="#ff4f70" />
              </label>
              <label>
                筆刷粗細 <span id="penSizeLabel">4</span>
                <input id="penSizeInput" type="range" min="1" max="20" step="1" value="4" />
              </label>
              <div class="pen-actions">
                <button id="penUndoBtn" type="button">復原一筆</button>
                <button id="penClearBtn" type="button">清空畫筆</button>
              </div>
            </div>
          </div>
        </details>

      </section>

      <section class="preview">
        <video id="rawVideo" playsinline muted hidden></video>
        <canvas id="previewCanvas"></canvas>
        <section id="timelinePanel" class="timeline-panel" hidden>
          <div class="timeline-head">
            <h2>剪輯時間軸</h2>
            <div class="timeline-meta">
              <span id="timeInfo">00:00.0 / 00:00.0</span>
              <span id="clipDurationInfo">剪輯長度: 00:00.0</span>
            </div>
          </div>
          <div class="timeline-actions">
            <button id="playPauseBtn" type="button">播放</button>
            <button id="previewRangeBtn" type="button">回放剪輯區段</button>
            <button id="saveClipBtn" type="button">儲存定稿</button>
            <button id="abortExportBtn" type="button" disabled>強制中斷</button>
            <button id="discardClipBtn" type="button">取消剪輯</button>
          </div>
          <div class="timeline-scroll">
            <div class="timeline-row">
              <label for="playheadInput">播放位置</label>
              <input id="playheadInput" type="range" min="0" max="1000" step="1" value="0" />
            </div>
            <div class="timeline-row">
              <label for="trimStartInput">
                剪輯範圍 <span id="trimRangeLabel">00:00.0 - 00:00.0</span>
              </label>
              <div id="trimRangeBar" class="trim-range">
                <div class="trim-range-track"></div>
                <div class="trim-range-selected"></div>
                <input id="trimStartInput" class="trim-handle trim-handle-start" type="range" min="0" max="1000" step="1" value="0" />
                <input id="trimEndInput" class="trim-handle trim-handle-end" type="range" min="0" max="1000" step="1" value="1000" />
              </div>
            </div>
            <div class="timeline-tail-space" aria-hidden="true"></div>
          </div>
          <details class="export-debug-wrap">
            <summary>Debug 詳細資訊</summary>
            <div class="export-debug" aria-live="polite">
              <div><strong>Debug 路徑:</strong> <span id="exportDebugRoute">待命</span></div>
              <div><strong>Debug 錯誤碼:</strong> <span id="exportDebugCode">-</span></div>
              <div><strong>Debug 訊息:</strong> <span id="exportDebugMessage">尚未輸出</span></div>
              <pre id="exportDebugTrace" class="export-debug-trace">Trace: 尚未輸出</pre>
            </div>
          </details>
        </section>
      </section>
    </main>

    <script src="./renderer.js"></script>
  </body>
</html>
